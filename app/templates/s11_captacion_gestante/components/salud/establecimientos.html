<!-- HTMX debe estar cargado ANTES del contenido -->
<script src="https://unpkg.com/htmx.org@1.9.2/dist/htmx.js"></script>

<main class="container">
  <div class="row">
    <div class="col-md-12">
      <section class="card card-body shadow mb-2">
        <div class="col-md-6 offset-md-3 text-center py-1 text-primary">
          <h4>REPORTE DE CAPTACION GESTANTE - ESTABLECIMIENTO DE SALUD</h4>
        </div>

        <form
          method="GET"
          action="{% url 'rpt_s11_captacion_gestante_establecimiento_xls' %}"
        >
          <!-- CABECERA: AÑO Y MESES -->
          <div class="row">
            <div class="col-md-2 form-group">
              <label class="text-danger" for="anio">AÑO:</label>
              <select class="form-control" id="anio" name="anio">
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026">2026</option>
                <option value="2027">2027</option>
              </select>
            </div>

            <div class="col-md-3 form-group">
              <label class="text-danger" for="fecha_inicio">MES INICIO:</label>
              <select
                class="form-control"
                id="fecha_inicio"
                name="fecha_inicio"
              >
                {% for m in mes_inicio %}
                <option value="{{ m.nro_mes }}">{{ m.Mes }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-3 form-group">
              <label class="text-danger" for="fecha_fin">MES FIN:</label>
              <select class="form-control" id="fecha_fin" name="fecha_fin">
                {% for m in mes_fin %}
                <option value="{{ m.nro_mes }}">{{ m.Mes }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-4 form-group">
              <label class="text-danger" for="cumple"
                >ESTADO ACTUALIZACION:</label
              >
              <select class="form-control" id="cumple" name="cumple">
                <option value="">Todos</option>
                <option value="1">Cumplen</option>
                <option value="0">NO Cumplen</option>
              </select>
            </div>
          </div>

          <!-- ========================================== -->
          <!-- NIVEL 1: RED DE SALUD -->
          <!-- ========================================== -->
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label class="text-primary" for="red">
                  <i class="fas fa-network-wired"></i> RED DE SALUD:
                </label>
                <select
                  class="form-control"
                  id="red"
                  name="red"
                  hx-get="{% url 'p_microredes_establec_s11_captacion_gestante' %}"
                  hx-trigger="change"
                  hx-target="#container-microredes"
                  hx-swap="innerHTML"
                  hx-indicator="#loading-microredes"
                >
                  <option value="">--- SELECCIONAR RED ---</option>
                  {% for p in redes %}
                  <option value="{{ p.codigo_red_filtrado }}">
                    {{ p.Red }}
                  </option>
                  {% endfor %}
                </select>
                <small id="loading-microredes" class="htmx-indicator text-info">
                  <i class="fas fa-spinner fa-spin"></i> Cargando microredes...
                </small>
              </div>
            </div>
          </div>

          <!-- ========================================== -->
          <!-- NIVEL 2: MICRORED -->
          <!-- ========================================== -->
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label class="text-primary" for="microred">
                  <i class="fas fa-project-diagram"></i> MICRORED:
                </label>
                <div id="container-microredes">
                  <select
                    class="form-control"
                    name="microred"
                    id="microred"
                    disabled
                  >
                    <option value="">--- Primero seleccione una RED ---</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- ========================================== -->
          <!-- NIVEL 3: ESTABLECIMIENTO -->
          <!-- ========================================== -->
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label class="text-primary" for="establecimiento">
                  <i class="far fa-hospital"></i> ESTABLECIMIENTO:
                </label>
                <div id="container-establecimientos">
                  <select
                    class="form-control"
                    name="establecimiento"
                    id="establecimiento"
                    disabled
                  >
                    <option value="">
                      --- Primero seleccione una MICRORED ---
                    </option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <hr />

          <!-- BOTÓN SUBMIT -->
          <div class="row">
            <div class="col-md-12 text-center">
              <button type="submit" class="btn btn-success btn-lg">
                <i class="fa fa-file-excel"></i> Procesar
              </button>
            </div>
          </div>
        </form>
      </section>
    </div>
  </div>
</main>

<!-- Estilos para indicador de carga -->
<style>
  .htmx-indicator {
    display: none;
  }
  .htmx-request .htmx-indicator,
  .htmx-request.htmx-indicator {
    display: inline-block;
  }
</style>
